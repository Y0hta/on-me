<main class="container-fluid mt--7">
  <div class="row">
    <div class="col">
      <div class="card card-profile shadow">
        <div class="card-header text-center border-0 pt-8 pt-md-4 pb-0 pb-md-4">
        </div>
        <div class="card-body pt-md-4">
          <div class="row justify-content-center">
            <div class="user-image">
              <%= attachment_image_tag @user, :image, :fill, 100, 100, :size => "100x100", fallback: "no-user-image.jpg", class: "shadow" %>
            </div>
          </div>
        </div>
        <div class="text-center">
          <h3>
            <%= @user.name %>
          </h3>
          <div class="h5 font-weight-300">
            <%= @user.occupation %>
          </div>
          <hr class="my-4" />
          <p class="mx-5 my-4"><%= @user.introduction %></p>
        </div>
      </div>
    </div>
    <div class="col ml-2">
      <div class="card shadow">
        <div class="card-header text-center border-0 pt-8 pt-md-4 pb-0 pb-md-4">
        </div>
        <div class="card-body pt-md-4 mx-4 mb-3">
          <h5><strong><%= @user.name %></strong> にコーヒーを奢る</h5><br />
          <!-- Stripe checkout form -->
          <%= form_with url: charges_path do |f| %>
            <article>
              <% if flash[:error].present? %>
                <div id="error_explanation">
                  <p><%= flash[:error] %></p>
                </div>
              <% end %>
            </article>

            <div class="row">
            </div>
            <div class="form-group">
              <%= f.text_field :customer_name, class: "form-control", placeholder: "Name" %>
            </div>
            <div class="form-group">
              <%= f.text_area :customer_message, class: "form-control", placeholder: "Message" %>
            </div>

            <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
              data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
                data-label="カードで支払う"
                data-name="<%= @user.name%> をサポートする"
                data-amount="300"
                data-locale="ja"
                data-currency="jpy"
                data-panel-label="{{amount}}のお支払い"></script>
          <% end %>
        </div>
      </div>
      <div class="card shadow my-4">
        <div class="card-header bg-transparent">
          <div class="row align-items-center">
            <div class="col">
              <h5 class="text-uppercase text-muted ls-1 mb-1">コーヒー履歴</h5>
            </div>
          </div>
        </div>
        <div class="card-body">
          <% if @transactions %>
            <% @transactions.each do |transaction| %>
              <p><%= transaction.customer_name %></p>
              <p><%= transaction.customer_message %></p>
            <% end %>
          <% else %>
            <p>コーヒー履歴がありません</p>
          <% end %>
          <br>
          <br>
          <br>
          <br>
          <br>
        </div>
      </div>
    </div>
  </div>
  <% 12.times do |br| %>
    <br />
  <% end %>
</main>
